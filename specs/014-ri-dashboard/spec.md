# Feature Specification: Relationship Intelligence Refinement (Dashboard Zone 2)

**Feature Branch**: `014-ri-dashboard`
**Created**: 2026-01-12
**Status**: Draft
**Input**: "Refine Relationship Intelligence (Dashboard Zone 2) based on RI_IA_v2.md and RI_Wireframe_v2.md"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - View Membership Distribution (Priority: P1)

As a Loyalty Program Manager, I want to see the breakdown of total vs. active members per tier, so that I can understand the engagement health of my customer base.

**Why this priority**: Essential for monitoring program participation and identifying tiers with low engagement.

**Independent Test**:
1.  Navigate to the Dashboard.
2.  Scroll to Zone 2A (Relationship Intelligence - Left Widget).
3.  Observe the "Total Members" and "Active Members" headline metrics.
4.  Hover over the stacked bars for each tier (Bronze, Silver, Gold).
5.  Verify the tooltip displays the specific Total and Active count for that tier.

**Acceptance Scenarios**:

1.  **Given** the dashboard loads, **When** I view Zone 2A, **Then** I see a stacked bar chart showing total and active members for each tier.
2.  **Given** I hover over the "Gold" tier bar, **When** the tooltip appears, **Then** it shows the exact count of Active Gold Members vs Total Gold Members.

---

### User Story 2 - View Tier Value Contribution (Priority: P2)

As a Loyalty Program Manager, I want to see which tiers contribute the most to sales revenue, so that I can focus my retention efforts on high-value segments.

**Why this priority**: Validates the financial impact of the loyalty program.

**Independent Test**:
1.  Navigate to the Dashboard.
2.  Scroll to Zone 2B (Relationship Intelligence - Right Widget).
3.  Observe the "Value Contribution" chart (Donut or Horizontal Bar).
4.  Verify the legend lists each tier with its Sales Amount and Contribution Percentage.

**Acceptance Scenarios**:

1.  **Given** the dashboard loads, **When** I view Zone 2B, **Then** I see the monetary value of sales generated by each tier.
2.  **Given** the sales data, **When** I check the percentages, **Then** the sum of all tier contributions equals 100% (or reflects the visible set).

---

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: The system MUST display a "Membership Distribution" widget in Zone 2A.
- **FR-002**: Zone 2A MUST show aggregate "Total Members" and "Active Members" metrics.
- **FR-003**: Zone 2A MUST display a stacked column chart (Dimension: Tier, Series 1: Total, Series 2: Active).
- **FR-004**: The system MUST display a "Value Contribution" widget in Zone 2B.
- **FR-005**: Zone 2B MUST display a chart showing Sales Amount per tier.
- **FR-006**: Zone 2B MUST display a legend/list with Tier Name, Sales Amount (Currency formatted), and Contribution % (Calculated).
- **FR-007**: The UI Layout MUST match `Product/Wireframes/RI_Wireframe_v2.md`.
- **FR-008**: The Data Logic MUST follow `Product/IA/RI_IA_v2.md`.

### Key Entities

- **Metrics**: Global dashboard metrics object (Needs enrichment).
- **TierMetric**: New data structure containing:
    - `id`: string
    - `name`: string
    - `memberCount`: number (Total in tier)
    - `activeCount`: number (Active in tier)
    - `totalSales`: number (Revenue from tier)
    - `salesPercent`: number (Share of total)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Dashboard loads Zone 2 widgets in under 200ms (client-side render).
- **SC-002**: Tooltips appear on hover within 50ms.
- **SC-003**: Sales percentages in Zone 2B accurately calculate to 100% (+/- 1% rounding).
- **SC-004**: Implementation matches Wireframe v2 spacing and layout exactly.
