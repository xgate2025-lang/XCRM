# Implementation Plan: Coupon Flow Adjustments

**Branch**: `011-coupon-flow-adjustments` | **Date**: 2026-01-07 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/011-coupon-flow-adjustments/spec.md`

## Summary

Adjust the Coupon Creation and Management flow to support "Dynamic Validity" (Delay + Duration), Product/Service values (text support), and enhanced Issuance/Redemption limits (Stores, Per-User frequency). This involves updating `Coupon` types, the `One-Page` Wizard UI, and the Mock Service layer.

## Technical Context

**Language/Version**: TypeScript (React 19)
**Primary Dependencies**: `lucide-react`, `react-router-dom`, `framer-motion`
**Storage**: Mock Service with `window.localStorage` persistence (no backend)
**Testing**: Manual Validation via `quickstart.md`
**Target Platform**: Web Browser (Desktop/Mobile responsive)
**Project Type**: Single Page Application (Vite)
**Performance Goals**: Instant wizard navigation (<100ms), immediate preview updates.
**Constraints**: Must maintain existing data compatibility or handle migration gracefully for LocalStorage.
**Scale/Scope**: ~500 LOC updates. Touchpoints: `types.ts`, `CreateCoupon.tsx`, `MockCouponService.ts`, `CouponWizardContext.tsx`.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] **IA Integrity & Coverage**: Proposed changes align with "Coupon Wizard" flows. New fields (Dynamic Validity) fit into existing "Lifecycle" section.
- [x] **Clarification Policy**: "Meaning of Product Value" and "Dynamic Anchor" clarified via `/speckit.clarify` (See `research.md`).
- [x] **Visual Consistency**: Will use existing `Input`, `Select`, and `Switch` components.
- [x] **No "Magic" Numbers**: Validity constants will be configurable or clearly defined.

*PRE-FLIGHT*: Read `Journal.md`. Lessons on "Wizard State Complexity" (2026-01-06) will be applied.

## Project Structure

### Documentation (this feature)

```text
specs/011-coupon-flow-adjustments/
├── plan.md              # This file
├── research.md          # Research & Decision Log
├── data-model.md        # Updated Schema Definitions
├── quickstart.md        # Manual Validation Guide
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
src/
├── components/
│   └── coupon/
│       ├── sections/
│       │   ├── EssentialsSection.tsx   # Update: Product text input
│       │   ├── LifecycleSection.tsx    # Update: Validity toggle & delay
│       │   └── InventorySection.tsx    # Update: Quota frequency inputs
│       └── LivePreview.tsx             # Update: Show new validity formats
├── pages/
│   └── CreateCoupon.tsx                # Main entry
├── services/
│   └── MockCouponService.ts            # Update: Data generation/persistence
├── context/
│   └── CouponWizardContext.tsx         # Update: Validation logic
└── types.ts                            # Update: Coupon Interface
```

**Structure Decision**: Extend existing `src` structure. No new directories needed.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A | | |
